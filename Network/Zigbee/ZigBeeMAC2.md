내용 너무 길어서 분할함

## 맥 프레임 포멧

IEEE 802.15.4 문서는 맥 프레임의 네 가지 일반적인 구조를 정의했다. <br>
비콘프레임, 데이터 프레임, 확인응답 프레임, 맥 명령 프레임 <br>

### 일반적인 맥 프레임 형식

![image](https://user-images.githubusercontent.com/38284141/52693585-6d86b000-2faa-11e9-95a6-39191c02ce64.png)

위 그림의 a는 일반적인 맥 프레임이다. 그리고 이건 세 부분으로 이루어져 있다. <br>
#### MHR(MAC header), MAC payload, MFR(MAC footer) <br>
첫 번째 필드는 프레임 타입(비컨, 데이터, 수신확인, MAC 명령)을 정의하는 프레임 제어(b그림)이다. <br>
보안 가능 서브필드를 1로 설정하면, 이 프레임은 보안 보호가 되며, 보조 헤더는 MAC 프레임의 일부가 된다. 그렇지 않으면 보조 헤더의 크기가 0이다. <br>
프레임 미결 하위 필드는 간접 데이터 전송 방식의 일부로 사용되며, 1로 설정되면, 수신 디바이스를 위한 전송 장치에 보류 중인 데이터가 있음을 의미한다. <br>
확인응답 요청 하위 필드가 1로 설정된 경우 수신용 디바이스는 확인응답 프레임을 전송해야 한다. <br>
<br>
동일한 PAN 내에서 통신할 때, PAN 식별자는 근원지와 목적지 디바이스 모두에서 동일할 것이므로, 한 프레임에서 두 식별자를 모두 반복할 필요는 없다. 
PAN ID 압축 하위 필드는 PAN 식별자의 불필요한 반복을 방지하는 데 도움이 된다. <br>
PAN ID 압축 필드를 1로 설정하면, 오직 목적지 PAN 식별자만 프레임에 포함되며, 근원지 PAN 식별자는 목적지와 동일한 것으로 가정한다. <br><br>

목적지 및 근원지 주소 지정 모드 하위 필드는 주소 지정 모드(16비트 단축 주소 또는 64비트 확장 주소)를 결정한다.<br> 
MAC 프레임의 목적지 및 주소 필드의 길이는 주소 지정 모드에 따라 달라진다. 그 다음 서브필드는 프레임 버전이다. <br>
IEEE 802.15.4 표준은 시간이 경과함에 따라 갱신될 수 있으며, 프레임 버전 하위 필드는 프레임 구성에 사용되는 IEEE 802.15.4의 버전을 결정한다.<br>
<br>

MAC 프레임의 다음 필드인 시퀀스 번호는 비컨 시퀀스 번호(BSN) 또는 DSN(데이터 시퀀스 번호)을 포함할 수 있다. <br>
시퀀스 번호 매기기 기능은 다양한 시퀀스를 구분하는 데 도움이 된다.<br>
예를 들어 수신한 프레임 2개의 시퀀스 번호가 동일한 경우, 동일한 프레임이 재전송되었음을 의미한다. <br>
첫 번째 프레임이 성공적으로 검출되면 두 번째 프레임(같은 시퀀스 번호)은 무시할 수 있다.<br>
<br>

BSN과 DSN의 값은 MAC-PIB 속성(macBSN 및 macDSN )으로 저장된다. <br>
BSN은 비콘 프레임에서만 사용된다. DSN은 비콘 프레임을 제외한 모든 유형의 프레임에 사용된다. <br>
디바이스는 macDSN값(비콘프레임의 경우 macBSN)을 랜덤한 숫자로 초기화하고, 각각의 전송 후 1회씩 증가시킨다.<br>
<br>

보조 보안 헤더는 MAC 프레임의 선택 필드로서, MAC 프레임을 보호하기 위해 사용되는 보안 레벨 및 보안 키의 종류 등의 정보를 담고 있다. <br>
MAC 프레임의 마지막 필드는 수신자가 수신된 프레임에서 발생 가능한 오류를 확인하기 위해 사용하는 FCS(프레임 검사 시퀀스) 필드다.<br>
<br>

### 프레임 체크 시퀀스 FCS(Frame Check Sequence)
IEEE 802.15.4는 데이터 패킷에서 가능한 오류를 검출하기 위해 국제 전기통신 연합(ITU) 주기적 중복 검사(CRC)에 기초한 16비트 FCS를 사용한다.<br>

CRC의 기본 개념은 다음과 같다. <br>
송신 장치에서는, MHR과 MAC 페이로드의 모든 비트는 다항식의 계수로 취급된다. <br>
그런 다음 이 다항식은 수신기와 송신기 둘 다에 의해 알려진 또 다른 다항식으로 구분된다. <br>
이 분할의 나머지 부분은 FCS라고 불리며 MAC 푸터(MFR)로서 프레임 끝에 추가된다. <br>
수신 장치는 동일한 분할을 수행하며 동일한 나머지를 얻을 것으로 예상한다. <br>
수신 장치에 의해 계산되는 나머지가 MFR의 송신 장치에 의해 제공된 나머지 부분과 동일하지 않으면, 수신 장치는 프레임이 오류로 수신된다고 결론짓는다.
<br><br>

IEEE 802.15.4의 FCS는 다음 단계를 거치면서 생성된다.<br>
1. 비트의 MHR 및 MAC 페이로드 시퀀스를 나타내는 다항식 M(x)을 정의한다.<br>
2. M(x)을 x^16로 곱하여 M(x) x^16을 생성한다.<br>
3. 다항식 M(x) * x^16를 (x^16 + x^12 + x^5 + 1)로 나눈다. <br>
이 나눗셈의 나머지를 프레임 체크 시퀀스로써 MFR에 넣는다. <br>

### 맥 비콘 프레임 포멧
비콘 프레임(밑에 그림)은 MAC 일반 프레임 형식의 특별한 형식이다. <br>
Sequence number 필드는 macBSN(beacon sequence number)의 현재 값을 포함하고 있다. <br>
![image](https://user-images.githubusercontent.com/38284141/52696878-82b40c80-2fb3-11e9-850b-0a0ba858a9a4.png)
<br>
슈퍼프레임 사양 필드는 MAC 페이로드의 일부로서, 그 서브 필드는 위 그림에 나타나 있다. <br>
비콘 순서(BO) 서브 필드는 비콘 사이의 전송 간격을 결정한다. <br>
SO(Superframe Order)에서는 슈퍼프레임의 활성기간을 명시하고 있다.<br>
<br>

슈퍼프레임은 16개의 동일한 시간 슬롯으로 나뉘며, 최종 CAP 슬롯 하위 필드는 CAP의 마지막 시간 슬롯을 결정한다.<br>
CAP 후 남은 시간 간격은 GTS로 사용한다. <br>
BLE 서브필드가 1로 설정되어 있는 경우, 에너지 절약을 위해 일정 시간 후에 비콘 디바이스가 수신기를 끄게 된다는 것을 의미한다.<br>
<br>

이 비콘 프레임이 PAN 코디네이터에 의해 송신되는 경우, PAN 코디네이터 하위 필드는 1로 설정된다. <br>
이것은 PAN 코디네이터와 같은 네트워크의 다른 코디네이터로부터 수신한 프레임을 구별하는 데 도움이 된다. <br>
슈퍼프레임 사양 필드의 마지막 비트는 연결 허가다. <br>
연결 허가가 0으로 설정되어 있으면, 코디네이터가 현시점에서 연결 요청을 받아들이지 않는 것을 의미한다.<br>
<br>

비콘 프레임은 GTS를 만드는 데 사용된다. <br>
GTS 사양 하위 필드는 PAN 코디네이터가 현재 GTS 요청을 수락하는지 여부를 명확하게 한다. <br>
또한 GTS 목록 필드에 열거된 GTS의 수를 결정한다. <br>
GTS 방향 하위 필드는 GTS의 방향을 수신 전용 또는 송신 전용 모드로 설정하는 데 사용할 수 있다. <br>
GTS 리스트는 현재 유지되고 있는 모든 GTS 리스트(GTS 설명자)이다. <br>
각 GTS 설명자는 GTS, GTS 시작 슬롯 및 GTS 길이를 사용할 디바이스의 짧은 주소를 포함하고 있다.<br>
<br>

보류 중인 주소 필드에는 코디네이터에서 보류 중인 데이터가 있는 모든 장치의 주소가 포함되어 있다. <br>
각 장치는 이 필드의 주소를 확인하고, 일치하는 항목이 있으면 코디네이터에게 연락하여 데이터가 전송되도록 요청한다. <br>
비콘 페이로드는 선택 필드로서 다음 상위 계층(NWK)에 의해 제공된다. <br>
<br>

### 맥 데이터 프레임 형식
![image](https://user-images.githubusercontent.com/38284141/52697920-cf004c00-2fb5-11e9-917e-43d69ac78df1.png)
<br>
MAC 데이터 프레임은 그림과 같다. 데이터 페이로드는 NWK 레이어에 의해 MSDU로 제공된다.<br>
MAC 데이터 프레임을 MPDU라고 부른다. <br>
시퀀스 번호 필드는 프레임이 생성되었을 때 현재 macDSN(데이터 시퀀스 번호)의 값과 같다.<br>

### 맥 확인응답 프레임 형식


