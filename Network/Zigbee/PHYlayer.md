## 직비 물리층

영어공부도 할겸 원서 내용을 싹다 번역해서 여기다 적을거다.

### 채널 할당
주파수 채널들은 채널 번호들과 페이지들에 의해 정의된다. 채널 페이지는 IEEE 802.15.4에서 지원되는 물리층들 사이를 구별하기 위해 추가된 개념이다. 이에 앞서 release된 IEEE 802.15.4표준에서 주파수 채널들은 단순히 채널 번호들로 식별됐다. 그리고 물리층을 선택할 수 없었다. 처음 공개됐을 때는 전체 27채널들 이상의 규정이 없었다. 그래서 다중 운영 주파수 대역을 구현하는 물리층들은 지원될 수 없었다. 각각의 채널 페이지는 최대 27개의 채널들을 가질 수 있다. 아래 표는 그 할당된 채널들을 보여준다. 0부터 2까지의 채널 페이지들은 현재 868/915 MHz 대역과 2.4GHz 대역에서 사용되고 있다. 3~31 채널 페이지들은 미래의 잠재적인 사용을 위해 예약되어 있다.<br>
![image](https://user-images.githubusercontent.com/38284141/51814805-774cba00-2300-11e9-9a43-dfb8a2ecabcc.png)
<br>
0번 채널 페이지는 2003년에 IEEE 802.15.4에 정의된 모든 채널을 지원한다. 1번과 2번 채널 페이지들은 2006년판 표준에서 소개된 선택적인 물리층들에 의해 사용된다. <br>
각 채널은 채널 번호에 의해 식별된다. 처음 3개의 채널 페이지에서 채널 번호 0은 주파수의 중심이 868.3MHz로 868Mhz대역에 할당되었다. 다른 주파수 대역들에서 가장 낮은 채널 번호는 가장 낮은 주파수에 할당된 1번이다...?
<br>
915MHz, 2.4GHz 대역에 있는 채널들의 센터 주파수들은 밑에 방정식으로 계산할 수 있다.<br>
#### 915MHz 대역의 중심 주파수 = 906 + 2 x (채널 번호 - 1)
#### 2.4GHz 대역의 중심 주파수 = 2405 + 5 x (채널번호 - 11)

### 에너지 검사,탐지,검출(energy detection)

디바이스가 메세지를 전송하려고 할 때, 먼저 원하는 채널의 신호 에너지 레벨을 검사하고 평가하기 위해 수신 모드로 동작한다. 이 과정이 energy detection이다. 관심있는 대역의 신호 에너지는 8개 심볼 기간동안 평균내어 진다. 에너지 탐지에서 수신기는 신호 타입을 탐지하려고 시도하지 않는다. 단지 신호의 에너지 레벨만 평가된다. 달리 말해서 만약 신호가 관심있는 주파수 대역에서 발생한다면, 동작하는 ED는 이 신호가 표준을 준수하는지 안하는지 들춰내지 않는다.<br>

ED는 수신기의 sensitivity 레벨에 가까운 에너지 레벨을 가진 약한 신호는 탐지해 낼 수 없을 수도 있다. 수신기 sensitivity는 수신기가 성공적으로 탐지할 수 있고 1%이하의 패킷오류로 복조해 낼 수 있는 가장 낮은 신호 에너지 레벨이다.  IEEE 802.15.4는 요구되는 수신기 sensitivity레벨과 요구되는 에너지 탐지 레벨 사이의 10데시벨 차이는 허락한다. (번역이 쉬운게 아니구만) 예를 들어 만약 요구되는 수신기 sensitivity 레벨이 85dBm이라면 ED는 75dBm 만큼 낮은 신호의 에너지를 탐지하고 측정할 수 있을 것이다. ED 범위는 최소한 40dB이상이어랴 한다. 예를 들어 75~35dBm처럼...
<br>
MAC층은 PHY층에게 ED를 수행할 것을 요청한다. PHY층은 관심있는 주파수 채널의 에너지 레벨을 8비트 정수로 나타내서 알려준다. 에너지 레벨의 정확도는 오차범위 6dB 이거나 더 좋다.
<br>

### 반송파 탐지(CS, carrier sense)
ED랑 비슷하게, CS는 주파수 채널이 사용할 수 있는지를 확인하는 방법이다. CS에서 디바이스가 메시지를 전송하려고 할 때, 우선 수신기가 원하는 주파수 채널에 존재할 수 있는 모든 가능한 신호의 타입을 탐지할 수 있는 모드로 들어간다. ED와 달리 CS에서 신호는 그 신호의 변조와 확산이 현재 디바이스에서 사용하는 물리층의 특성에 맞는지 확인하기 위해 복조된다. 만약 신호가 표준에 맞으면 디바이스는 신호의 에너지 레벨에 관계없이 그 채널이 바쁜 채널이라고 생각한다.

### 링크 품질 표시기(LQI, Link Quality Indicator)
LGI는 수신기가 받는 데이터 패킷의 품질을 표시한다. 수신된 신호의 강도는 신호의 품질을 측정하는데 사용될 수 있다. 수신신호강도는 수신된 신호의 전체 에너지의 측정값이다. 신호대잡음비는 신호 품질을 판단하는 또다른 방법이다. 일반적으로 높은 신호대잡음비는 패킷의 에러가 적다는 것을 뜻한다. 그러므로 높은 신호대잡음비를 가진 신호는 좋은 품질의 신호로 여겨진다. 링크 품질은 신호 에너지와 신호대잡음비 둘 모두를 사용해서 판단될 수도 있다.
<br>
LQI 측정은 수신된 패킷 각각에 모두 수행된다. LQI는 반드시 최소한 8개의 유일한 레벨들을 가진다. LQI는 MAC에게 알려지고 NWK와 APL계층에서 어떤 종류의 분석에라도 이용할 수 있다.
예를 들어 NWK층은 네트워크의 디바이스가 메시지를 어떤 경로로 보낼지 결정하는 데에 보고된 LQI 레벨을 사용할 수 있다. 일반적으로 LQI가 끝에서 끝까지 뫂은 경로가 메시지를 목적지까지 전송하는데 더 나은 기회를 가지는 것이다. LQI는 메시지 전달 경로를 고르는데 유일한 결정요소다. 전송 에너지 효율과 같은 다른 요소들도 경로 선정에 영향을 미칠 수는 있다. 예를 들어 배터리로 동작하는 디바이스가 링크 품질의 관점에서 좋은 위치에 있더라도, 이 디바이스를 통해 자주 메시지를 전송한다면 이 디바이스는 네트워크에 있는 다른 디바이스들보다 일찍 배터리가 고갈될 것이다.<br>

### 깨끗한 채널 평가(CCA, clear channel assessment)
CSMA-CA 채널 접근 메카니즘의 첫번째 스텝으로, MAC은 해당 채널을 다른 디바이스가 안쓰고 있는지 확실히 하기 위해 PHY에게 CCA 작동을 요청한다. CCA는 PHY 서비스의 한 부분이다. CCA에서, ED나 CS의 결과는 주파수 채널이 바쁜지 사용할 수 있는지를 결정하는데 사용될 수 있다. CCA 과정은 8개의 심볼들이어야 한다.<br>
CCA모드는 3개가 있다. 표준을 준수하는 PHY는 반드시 이것들로 작동이 가능해야 한다.<br>
#### CCA mode1
이 모드는 ED 결과만 평가에 들어간다. 만약에 에너지 레벨이 ED 임계치보다 위에 있으면, 채널은 바쁘다고 여겨진다. ED임계치 레벨은 제조하는 사람에 따라 설정될 수 있다.
#### CCA mode 2
2번 모드는 CS 결과만 사용한다. 오직 발생신호가 해당 디바이스의 PHY을 준수하는 경우에만 채널이 바쁘다고 여겨진다.(같은 신호를 쓴다는 말이겟지)
#### CCA mode 3
3번 모드는 1번모드와 2번모드의 논리적인 결합(AND/OR)이다. 그러니까 3번 모드에서 PHY는 바쁜 채널의 표지를 사용할 수 있다.
<br> 1. 탐지된 에너지 레벨이 임계치보다 높고 준수된 반송파가 감지된다.
<br> 2. 탐지된 에너지 레벨이 임계치보다 높거나 준수된 반송파가 감지된다.
<br>
디바이스가 사용할 CCA 모드는 PHY-PIB(PHY PAN Information Base)에 PHY 속성으로 저장된다. PHY-PIB는 밑에서 다시 설명한다.

### PHY constants and attributes 물리층 상수들과 속성들
상수들은 프레임의 최대 크기나 이벤트 지속기간과 같은 특성들을 정의한다. 프로토콜의 각 층들은 각자 이런 상수들을 가지고 있다. PHY는 밑에 표처럼 두 개의 상수만 가지고 있다. 
![image](https://user-images.githubusercontent.com/38284141/51819703-b6860580-2316-11e9-8ce4-4ad0c113749d.png)
<br>
첫번째 상수는 PSDU(PHY service data unit)가 127 옥텟을 초과할 수 없다는 것을 가리킨다. (옥텟이 바이트를 의미하는건가?)<br>
두번쨰 상수는 송수신기가 TX에서 RX로 혹은 반대로 바꾸는데 걸리는 시간이다. 이 상수에 기초해서 송수신기는 12심볼 이내로 바꾸는 걸 완료해야 한다.<br>
MAC과 PHY 프로토콜 계층들에서, 모든 상수들은 일반적인 접두사로 a를 갖는다. NWK와 APL은 상수들의 접두사로 각각 nwkc와 apsc를 갖는다. 상수들은 작동하는 동안 바뀔 수 없다.<br>
속성들은 작동하는 동안 바뀔 수 있는 변수다. PHY 속성들은 PHY-PIB에 포함된다. 이런 속성들은 PHY의 서비스들을 관리하길 요구된다. PHY-PIB 속성들의 목록이 밑에 표에 나와있다.
![image](https://user-images.githubusercontent.com/38284141/51820365-d4546a00-2318-11e9-886b-ba9ab45c318f.png)
<br>
 표에서 십자가 모양은 읽기 전용 속성이다. 더 높은 계층은 이 속성을 읽을 수 있지만 PHY만 이들을 바꿀 수 있다. * 으로 표시된 속성들은 읽기 전용인 특정 비트들을 가지고 있다. 이런 표시가 없는 비트들은 상위 계층에 의해 읽히거나 변경될 수 있다. PHY만 읽기 전용 비트들을 변경할 수 있다. 이런 속성들의 규칙들을 여기서 명확히 짚고 넘어가자.
 
 ### 물리층 서비스들
 물리층은 두가지 타입 서비스를 제공한다. 첫번째는 PHY 데이터 서비스이고 두번째는 PHY 관리 서비스다. PHY 데이터 서비스는 PPDU(PHY Protocol Data Unit)를 비율 채널(ratio channel)을 가로질러(교차하여) 송수신을 가능하게 한다. PHY는 밑에 그림에서 보이는 PLME(Physical Layer Management Entity)라고 불리는 관리 본체를 포함한다.<br>
 ![image](https://user-images.githubusercontent.com/38284141/51820987-da4b4a80-231a-11e9-8051-ca0cff1f128e.png)
 <br>
 PHY 관리 요소는 PLME에 의해 호출될 수 있다. PHY 데이터 서비스는 PD-SAP(PHY Data Service Access Point)를 통해 접근된다.<br>
 PHY 관리 서비스는 PLME-SAP를 통해 접근된다. PLME는 또한 PIB를 유지한다.
 
#### PHY 데이터 서비스
전송되어야 하는 데이터는 항상 MPDU(MAC Protocol Data Unit)로 제공된다. 로컬 MAC은 MPDU 제공과 전송 요청을 발생시킨다. PHY는 전송을 시도하고 시도에 대한 결과가 성공인지 아닌지를 MAC에게 보고한다. 전송 시도 실패의 이유들은 다음 중 하나일 수 있다.
<br> 1. 라디오 송수신기가 사용불가다.
<br> 2. 라디오 송수신기가 수신모드다. 라디오는 동시에 송수신을 할 수 없다.
<br> 3. 라디오 송수신기가 이미 전송에 사용되느라 바쁘다.<br>
데이터가 라디오 송수신기에 의해 수신될 때, PHY는 MAC에게 MPDU의 도착을 알린다. PHY는 MPDU를 MAC에게 전달할 뿐 아니라 LQI정보도 배달한다.<br>
아래 그림은 디바이스 사이에서 데이터가 전송되는 과정을 나타낸다.
![image](https://user-images.githubusercontent.com/38284141/51821548-e506df00-231c-11e9-9ee0-ad7e331013f5.png)
<br>
데이터는 항상 응용층에서 오는 것이 아니다. 예를들어 데이터는 더 높은 층에서 받지 않고 MAC층에서 발생될 수도 있다. 위 그림에서 데이터는 ZDO(ZigBee Device Objects)나 APS(Application Support sublayers)어플리케이션 객체 중의 하나로 제공된다. 송신하는 디바이스에서 각 계층은 각각의 헤더와 푸터(푸터는 적용할수있다면)를 데이터 유닛(DU)에 붙이고 밑에 계층에게 내려보낸다. <br>
DU는 각 계층의 이름을 따서 짓는다. 응용층에서는 APDU, 네트워크층에서는 NPDU, PHY 데이터 서비스는 MPDU를 받아서 PPDU로 만들어 전송한다.<br>
수신측에서는 데이터가 DU가 목적지 계층에 도착할 때 까지 위 계층으로 올라갈 때마다 헤더와 푸터가 제거된다. <br>

#### PHY 관리 서비스
PLME-SAP(Physical Layer Management Entity - Service Access Point)는 밑에 그림에서 MLME(MAC Layer Management Entity)와 PLME 사이의 전송을 명령하도록 이용된다.
