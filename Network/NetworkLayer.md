# 네트워크층 개요

## 네트워크층 서비스

### 패킷화(packetizing)
네트워크층의 첫 번째 의무. 발신지부터 목적지까지 내용의 변경이나 활용없이 페이로드를 운반하는 것.<br>
발신지 네트워크층은 상위계층 프로토콜로부터 페이로드를 수신한다. 여기에 발신지와 목적지 주소, 기타 정보를 헤더로 추가하고 <br>
데이터링크층에 전달한다. 이 패킷이 너무 커서 분할해야 하는 경우를 제외하고는 내용 변경이 일어나지 않는다.<br>

### 라우팅(routing) 
패킷이 목적지까지 갈 수 있도록 경로를 지정하는 것. 많은 경로 중에서 가장 좋은 경로를 찾는다.

### 포워딩(forwarding)
포워딩이란 라우터에 패킷이 도착했을 때 라우터가 취하는 행동이다. 이 행동을 위해 사용하는 의사결정 테이블을 포워딩테이블 혹은 라우팅테이블이라고 부른다. 라우터가 패킷을 수신했을 때 이 패킷을 다른 네트워크 하나로 포워딩하거나 여러 네트워크로 포워딩한다. 이 결정을 위해 라우터는 패킷 헤더에 있는 목적지 주소나 레이블 정보를 사용한다.

### 기타 서비스들
검사합을 통한 오류제어, 개념적인 혼잡제어

## 패킷 스위칭
현재 패킷 교환 네트워크에서 패킷의 경로를 찾기 위해서 두 가지 방식을 사용한다.<br>
1. 데이터그램 방식 2. 가상회선방식 <br>
### 데이터그램 방식
인터넷을 처음 만들 때 네트워크층 간소화를 위해서 모든 패킷을 독립적으로 처리하는 비연결형 서비스를 제공하도록 설계됐다.<br>
그래서 모든 패킷들은 각자 경로가 다를 수가 있었고, 각 패킷은 연관성이 없었다.<br>
이런 네트워크 형태의 교환기를 라우터라고 한다. 
![image](https://user-images.githubusercontent.com/38284141/51151847-aea67a00-18af-11e9-991d-36fef3bf8a24.png)

### 가상 회선 방식
이 방식에서 한 메시지에 속한 모든 패킷은 연관성이 있다. 데이터그램이 비연결 서비스라면 이건 연결지향 서비스다.<br>
이 방식을 사용하려면 발신지, 목적지 주소 뿐 아니라 가상회선을 정의하는 식별자인 레이블이 필요하다.<br>
![image](https://user-images.githubusercontent.com/38284141/51153169-76546b00-18b2-11e9-81b2-f2c3de33e8f1.png)
연결 설정, 데이터 전송, 연결 해제 3단계로 구성되는데 <br>
연결 설정 단계에서는 연결 지향성 서비스를 위해 발신자와 수신자의 주소로 테이블 항목을 생성한다. 즉 가상 회선을 위한 항목을 라우터가 생성한다.<br>
가상 회선을 생성하기위해 발신자와 수신자는 요청패킷, 확인응답 패킷을 서로 주고 받는다.<br>
요청 패킷이 이동할 때는 출력 레이블을 모르는 상태다.
![image](https://user-images.githubusercontent.com/38284141/51153214-a996fa00-18b2-11e9-9b0c-37abcf792605.png)
<br>
확인응답 과정에서는 수신측이 발신측으로부터 오는 패킷에 입력 레이블로 77을 선택해서 라우터 R4가 출력 레이블로 77을 갖게 된다.
![image](https://user-images.githubusercontent.com/38284141/51153463-a6e8d480-18b3-11e9-96df-5791600894e5.png)
연결 해제 단계에서는 라우터에 생성된 그 테이블 항목을 삭제한다.<br>

